<!DOCTYPE html>
<html lang="pt-br">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Login ADM</title>
        <link rel="stylesheet" href="style.css">
    </head>

    <body>
        <!-- Página de Login -->
        <div class="login-container" id="login-container">
            <h1>Login</h1>
            <form id="login-form">
                <div class="input-group">
                    <label for="username">Usuário</label>
                    <input type="text" id="username" name="username" required placeholder="Digite seu usuário">
                </div>

                <div class="input-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" name="password" required placeholder="Digite sua senha">
                </div>

                <button type="submit" class="btn-login">Entrar</button>
            </form>
            <p id="error-message" style="color: red; display: none;">Usuário ou senha incorretos!</p>
        </div>

        <!-- Página Principal -->
        <div class="main-container" id="main-container" style="display: none;">
            <div class="navbar">
                <ul>
                    <li><a href="#" id="disparo">Disparo de E-mails</a></li>
                    <li><a href="#" id="acessar-emails">Acessar E-mails dos Clientes</a></li>
                </ul>
            </div>

            <div class="container" id="container-disparo">
                <h1>Disparo de E-mail</h1>
                <div class="input-group">
                    <label for="campo-dinamico">Campo Dinâmico</label>
                    <select id="campo-dinamico">
                        <option value="nome">Nome</option>
                        <option value="sobrenome">Sobrenome</option>
                        <option value="email">Email</option>
                    </select>
                </div>

                <form action="#" method="post">
                    <div class="input-group">
                        <label for="destinatarios">Destinatários</label>
                        <textarea id="destinatarios" name="destinatarios" rows="3" required
                            placeholder="exemplo1@dominio.com, exemplo2@dominio.com"></textarea>
                    </div>

                    <div class="input-group">
                        <label for="assunto">Assunto</label>
                        <input type="text" id="assunto" name="assunto" required placeholder="Assunto do E-mail">
                    </div>

                    <div class="input-group">
                        <label for="mensagem">Mensagem</label>
                        <textarea id="mensagem" name="mensagem" rows="6" required
                            placeholder="Digite sua mensagem aqui..."></textarea>
                    </div>

                    <div class="input-group">
                        <label for="anexo">Anexar Imagem</label>
                        <input type="file" id="anexo" name="anexo" accept="image/*">
                    </div>

                    <div class="input-group">
                        <label for="agendamento">Agendar Envio</label>
                        <input type="datetime-local" id="agendamento" name="agendamento">
                    </div>

                    <div class="input-group">
                        <label for="importar-emails">Importar Lista de Emails (CSV)</label>
                        <input type="file" id="importar-emails" accept=".csv">
                    </div>
                    <button onclick="importarEmails()" class="btn-importar">Importar Emails</button>

                    <button type="submit" class="btn-enviar">Enviar E-mail</button>
                </form>
            </div>

            <div class="container" id="container-emails" style="display: none;">
                <h1>E-mails dos Clientes</h1>
                <ul class="email-list" id="email-list">
                    <!-- A lista de e-mails será gerada aqui -->
                </ul>

                <h2>Adicionar Novo E-mail</h2>
                <div class="input-group">
                    <label for="novo-email">Novo E-mail</label>
                    <input type="email" id="novo-email" placeholder="novoemail@dominio.com">
                </div>
                <button onclick="adicionarEmail()" class="btn-adicionar">Adicionar E-mail</button>
            </div>
        </div>

        <script>
            // Função de login
            document.getElementById('login-form').addEventListener('submit', function (event) {
                event.preventDefault(); // Impede o envio do formulário

                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                // Verifica se o login é válido
                if (username === 'Tuquis' && password === '123456') {
                    // Oculta a tela de login e exibe a tela principal
                    document.getElementById('login-container').style.display = 'none';
                    document.getElementById('main-container').style.display = 'block';
                } else {
                    // Exibe mensagem de erro
                    document.getElementById('error-message').style.display = 'block';
                }
            });

            // Lista de e-mails (no JavaScript)
            let listaEmails = [

            ];

            // Função para alternar entre as telas
            document.getElementById('disparo').addEventListener('click', function () {
                document.getElementById('container-disparo').style.display = 'block';
                document.getElementById('container-emails').style.display = 'none';
            });

            document.getElementById('acessar-emails').addEventListener('click', function () {
                document.getElementById('container-disparo').style.display = 'none';
                document.getElementById('container-emails').style.display = 'block';
                exibirEmails(); // Atualiza a lista de e-mails quando acessar a página
            });

            // Função para exibir os e-mails na lista
            function exibirEmails() {
                const listaElement = document.getElementById('email-list');
                listaElement.innerHTML = '';

                listaEmails.forEach(email => {
                    const li = document.createElement('li');
                    li.textContent = email;

                    // Botão de remover
                    const btnRemover = document.createElement('button');
                    btnRemover.textContent = 'Remover';
                    btnRemover.onclick = () => removerEmail(email.id); // Supondo que cada email tenha um ID
                    li.appendChild(btnRemover);

                    // Botão de atualizar
                    const btnAtualizar = document.createElement('button');
                    btnAtualizar.textContent = 'Atualizar';
                    btnAtualizar.onclick = () => atualizarEmail(email.id); // Supondo que cada email tenha um ID
                    li.appendChild(btnAtualizar);

                    listaElement.appendChild(li);
                });
            }


            async function adicionarEmail() {
                const novoEmail = document.getElementById('novo-email').value;

                if (!novoEmail) {
                    alert('Por favor, insira um email válido.');
                    return;
                }

                try {
                    const resposta = await fetch('/adicionar_email', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ nome: '', sobrenome: '', email: novoEmail }),
                    });

                    const resultado = await resposta.json();

                    if (resposta.ok) {
                        alert('Email adicionado com sucesso!');
                        document.getElementById('novo-email').value = ''; // Limpa o campo
                        exibirEmails(); // Atualiza a lista de emails
                    } else {
                        alert(resultado.erro || 'Erro ao adicionar email.');
                    }
                } catch (erro) {
                    alert('Erro ao conectar com o servidor.');
                }
            }

            //Função para enviar email (disparo de email)
            document.querySelector('#container-disparo form').addEventListener('submit', async function (event) {
                event.preventDefault();

                const destinatarios = document.getElementById('destinatarios').value.split(',').map(email => email.trim());
                const assunto = document.getElementById('assunto').value;
                const mensagem = document.getElementById('mensagem').value;

                try {
                    const resposta = await fetch('/enviar_email', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ destinatarios, assunto, mensagem }),
                    });

                    const resultado = await resposta.json();

                    if (resposta.ok) {
                        alert('Emails enviados com sucesso!');
                    } else {
                        alert(resultado.erro || 'Erro ao enviar emails!');
                    }
                } catch (erro) {
                    alert('Erro ao conectar com o servidor!');
                }

                async function importarEmails() {
                    const arquivo = document.getElementById('importar-emails').files[0];

                    if (!arquivo) {
                        alert('Por favor, selecione um arquivo CSV.');
                        return;
                    }

                    const formData = new FormData();
                    formData.append('arquivo', arquivo);

                    try {
                        const resposta = await fetch('/importar_emails', {
                            method: 'POST',
                            body: formData,
                        });

                        const resultado = await resposta.json();

                        if (resposta.ok) {
                            alert('Emails importados com sucesso!');
                            exibirEmails(); // Atualiza a lista de emails
                        } else {
                            alert(resultado.erro || 'Erro ao importar emails.');
                        }
                    } catch (erro) {
                        alert('Erro ao conectar com o servidor.');
                    }
                }
            });

        </script>
    </body>

</html>